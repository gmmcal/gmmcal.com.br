language: ruby

dist: xenial

jobs:
  include:
    - stage: deploy
      script: skip
      deploy: &heroku
        provider: heroku
        app: gmmcal-dev
        api_key: $HEROKU_AUTH_TOKEN
        run:
          - "rails db:migrate"
          - "rails db:seed:all"
          - "rails db:cache:clear"
        on:
          branch: master

    - stage: deploy
      script: skip
      deploy: &heroku
        provider: heroku
        app: gmmcal
        api_key: $HEROKU_AUTH_TOKEN
        run:
          - "rails db:migrate"
          - "rails db:cache:clear"
        on:
          all_branches: true
          tags: true
